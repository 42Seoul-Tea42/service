(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{4627:function(e,t,n){Promise.resolve().then(n.bind(n,1341))},8994:function(e,t,n){"use strict";n.d(t,{NL:function(){return m},L0:function(){return u},ZO:function(){return l}});var s=n(7580),r=n(6406),i=n.n(r),l=e=>{let[t,n]=(0,s.useState)([]),[r,l]=(0,s.useState)("distance"),[a,o]=(0,s.useState)("ascending");return(0,s.useEffect)(()=>{e&&n([...e].sort((e,t)=>{let n=i()(e,r),s=i()(t,r),l=0;return n<s&&(l=-1),n>s&&(l=1),"descending"===a?-1*l:l}))},[e,r,a]),[t,l,o]},a=n(129),o=n(9690),c=n.n(o),d=n(7474),u=e=>{let[t,n]=(0,s.useState)([]),r=(0,a.v9)(e=>e.searchSlice.searchParams),i=(0,a.I0)();return[t,()=>{e&&(n([...e].filter(e=>{let t=e.age>=r.minAge&&e.age<=r.maxAge,n=e.distance<=r.distance,s=0===r.rating||e.rating>=r.rating,i=0===r.interests.length||c().some(e.interests,e=>c().includes(r.interests,e));return t&&n&&s&&i?e:null})),i((0,d.Sz)()))}]},m=e=>{let{initialState:t}=e,n=(0,s.useRef)(null),[r,i]=(0,s.useState)(t),l=e=>{n.current&&!n.current.contains(e.target)&&i(!1)};return(0,s.useEffect)(()=>{if(r)return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[r]),[n,r,i]}},1341:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return $}});var s,r,i=n(657),l=n(129),a=n(1561),o=n(7580),c=n(1183);let d=(e,t)=>{t.map(t=>{let{event:n,once:s,handler:r}=t;s?e.once(n,e=>{console.log("[Socket.ONCE] ".concat(n," data: "),e),r(e)}):e.on(n,e=>{console.log("[Socket.ON] ".concat(n," data: "),e),r(e)})})},u=(e,t)=>{t.map(t=>{let{event:n}=t;e.off(n)})};var m=n(8743),x=n(3487),h=function(e){let{socket:t}=e,n=(0,l.I0)(),s=(0,l.v9)(e=>e.accountSlice.user.id),r=(0,l.v9)(e=>e.chattingSlice.currentUser.id);(0,o.useEffect)(()=>{if(!t)return;let e=[{event:"new_match",handler:()=>{n((0,m.nn)(!0))}},{event:"unmatch",handler:e=>{n((0,m.nn)(!0)),n((0,m.N$)(!0))}},{event:"new_fancy",handler:e=>{n((0,x.mt)(!0)),n((0,x.x6)(e.target_id))}},{event:"unfancy",handler:e=>{n((0,x.yB)(e.target_id))}},{event:"new_visitor",handler:()=>n((0,x.oP)(!0))},{event:"send_message",handler:e=>{let t=e.senderId;(t===s||t===r)&&n((0,m.aC)(e))}},{event:"update_status",handler:e=>{n((0,m.ij)({status:e.status,targetId:e.target_id}))}}];return d(t,e),()=>{u(t,e)}},[t])},g=n(1749);let f=(0,o.createContext)(void 0),j=()=>(0,o.useContext)(f);function v(e){let{children:t}=e,[n,s]=(0,o.useState)();h({socket:n});let r=g.env.NEXT_PUBLIC_DOMAIN;return(0,o.useEffect)(()=>{let e=localStorage.getItem("id"),t=(0,c.io)(null!=r?r:"",{withCredentials:!1,autoConnect:!1,transports:["websocket","polling"],closeOnBeforeunload:!0,reconnection:!0,auth:{id:e}});return t.on("connect",()=>{console.log("\uD83D\uDE80","socket connected"),s(t)}),t.on("disconnect",()=>{console.log("\uD83D\uDEE0","socket disconnected"),s(void 0)}),t.connect(),()=>{t.disconnect()}},[]),(0,i.jsx)(f.Provider,{value:n,children:t})}var b=()=>{let e=(0,l.I0)(),t=j();return(0,i.jsx)("footer",{className:"fixed bottom-0 w-full border-t bg-white",children:(0,i.jsx)("ul",{className:"flex sm:flex-row grid-cols-2 flex-col items-center justify-center px-5 py-5 text-md font-medium text-gray-500 sm:mt-0",children:(0,i.jsx)("li",{className:"mx-5 sm:mb-0",children:(0,i.jsx)("button",{onClick:()=>{e((0,a.BG)()),null==t||t.disconnect()},className:"hover:underline",children:"로그아웃"})})})})},p=n(7789),w=function(e){var t;let{item:n}=e,s=(0,l.v9)(e=>e.suggestionSlice.visitorNoti),r=(0,l.v9)(e=>e.suggestionSlice.fancyNoti);return(0,i.jsx)("div",{className:"on"===n.noti?"":"hidden",children:(0,i.jsx)("div",{className:"Fancy"===(t=n.name)&&!0===r||"Visitor"===t&&!0===s?"":"hidden",children:(0,i.jsx)("span",{className:"animate-pulse bg-red-500 absolute left-0 bottom-0 w-4 h-4 border-2 border-white rounded-full"})})})},N=n(4918),y=n(2194),S=n(3421),k=n(9711),C=()=>{let[e,t]=(0,o.useState)(!1),n=(0,p.useRouter)();(0,o.useEffect)(()=>{s((0,a.t2)()),(0,N.Z)()},[]);let s=(0,l.I0)(),r=e=>{s((0,x.PJ)());let r=e.toLowerCase();n.push(r),t(!1)},c=(0,p.usePathname)(),d=e=>c==="/".concat(e.toLowerCase()),u=e=>d(e)?"text-green-400":"currentColor",m=[{name:"Fancy",icon:(0,i.jsx)(S.yy,{}),noti:"on"},{name:"Visitor",icon:(0,i.jsx)(S.tn,{}),noti:"on"},{name:"History",icon:(0,i.jsx)(S.ax,{}),noti:"off"},{name:"Home",icon:(0,i.jsx)(S.xt,{}),noti:"off"},{name:"Search",icon:(0,i.jsx)(S.Mt,{}),noti:"off"},{name:"Setting",icon:(0,i.jsx)(k.GW,{}),notio:"off"}];return(0,i.jsx)("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-white border-gray-200",children:(0,i.jsxs)("div",{className:"max-w-screen flex flex-wrap items-center justify-start md:justify-center mx-auto p-4 shadow",children:[(0,i.jsxs)("button",{type:"button",onClick:()=>t(!e),className:"inline-flex items-center w-8 h-8 justify-center border text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200",children:[(0,i.jsx)("span",{className:"sr-only",children:"Open main menu"}),(0,i.jsx)(S.it,{})]}),(0,i.jsx)("div",{className:"w-full md:block md:w-auto ".concat(e?"block":"hidden"),id:"navbar-default",children:(0,i.jsx)("ul",{className:"flex flex-col p-4 gap-5 md:p-0 mt-4 rounded-lg bg-gray-50 md:flex-row md:space-x-8 rtl:space-x-reverse md:mt-0 md:border-0 md:bg-white text-xl",children:m.map((e,t)=>(0,i.jsxs)("li",{className:"relative",children:[(0,i.jsx)(y.iP,{buttonName:e.name,icon:e.icon,iconStyle:u(e.name),handleClick:()=>r(e.name)}),(0,i.jsx)(w,{item:e}),(0,i.jsx)("div",{className:d(e.name)?"":"hidden",children:(0,i.jsx)("span",{className:"animate bg-green-200 absolute w-24 h-2 border-2 border-white  rounded-full"})})]},t))})})]})})},I=n(6731),E=e=>{let{isOpen:t,onClick:n}=e,s=(0,l.v9)(e=>e.chattingSlice.chattingNoti);return(0,i.jsxs)("button",{onClick:n,className:"flex flex-col bg-gray-200 hover:bg-gray-400 text-green-400 border border-gray-300 items-center justify-center rounded-3xl w-24 h-24 fixed bottom-10 right-10 shadow-md",children:[(0,i.jsx)("div",{className:s?"animate-pulse":"hidden",children:(0,i.jsx)("span",{className:"bg-red-500 animate-bounce absolute top-0 right-0 w-4 h-4 border-2 border-white rounded-full"})}),(0,i.jsx)(I.Z,{style:"rounded-full w-24 h-12",backgroundColor:"#e5e7eb"}),(0,i.jsx)("p",{className:"font-bold text-shadow",children:"Chat"})]})},_=n(8994),L=n(7263),O=function(e){let{props:t}=e,n=(0,l.I0)(),[s,r,a]=(0,_.NL)({initialState:!1}),c=(0,l.v9)(e=>e.chattingSlice.exitUser);return(0,o.useEffect)(()=>{c&&(a(!1),n((0,m.jN)(!1)),n((0,m.N$)(!1)))},[c]),(0,i.jsxs)("div",{ref:s,className:"fixed right-10 bottom-36 z-50",children:[(0,i.jsx)("div",{className:r?"":"hidden",children:t}),(0,i.jsx)(E,{isOpen:r,onClick:()=>{n((0,m.nn)(!1)),n((0,m.jN)(!0)),a(!r),n((0,L.O$)())}})]})},P=n(6400),M=n(3400),D=function(e){let{user:t}=e,n=(0,l.I0)();return(0,i.jsxs)("li",{onClick:()=>{n((0,L.SQ)({targetId:t.id,time:(0,P.I)({time:"now"})})),n((0,m.jY)()),n((0,m.U6)(t)),n((0,m.jN)(!1)),n((0,m.sl)("down"))},className:"flex items-end p-4 gap-2 border-b border-green-400 hover:brightness-75 bg-green-200",children:[(0,i.jsx)(M.default,{className:"w-8 h-8 rounded-full",src:t.picture,width:100,height:100,alt:"".concat(t.name," image")}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("p",{className:"font-medium text-lg text-gray-900 truncate ",children:t.firstname})," ",(0,i.jsxs)("p",{className:"items-end ml-2 text-sm text-gray-900 ",children:[t.distance,"km"]})]})]})},U=function(){let e=(0,l.v9)(e=>e.chattingSlice.users),t=(0,l.v9)(e=>e.chattingSlice.chattingListModal);return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsxs)("ul",{className:"absolute w-full h-full overflow-hidden border rounded-xl bg-green-50",children:[(0,i.jsxs)("div",{className:"flex p-1 text-teal-700",children:[(0,i.jsx)("p",{children:" 채팅방 "}),(0,i.jsx)("p",{className:e.length?"hidden":"",children:"이 없습니다."})]}),e.map((e,t)=>(0,i.jsx)(D,{user:e},t))]})})},B=n(9501),T=n.n(B),z=function(e){let{MenuBar:t,viewMessage:n,sendMessage:s}=e;return(0,i.jsxs)("div",{children:[t,(0,i.jsx)("div",{className:"border-l border-r",children:n}),s]})},Z=n(2038),G=n(55),H=n(188),A=function(){let e=(0,l.v9)(e=>e.chattingSlice.currentUser),t=(0,l.I0)(),n=n=>{t((0,H.kG)(!0)),t((0,G.yB)(n)),t((0,H.UM)(e))};return(0,i.jsxs)("div",{className:"flex justify-between items-end p-4 border rounded-t-xl shadow-sm",children:[(0,i.jsxs)("button",{className:"flex justify-center items-end",onClick:()=>n(e.id),children:[(0,i.jsx)(M.default,{className:"w-10 h-10 rounded-xl",src:e.picture,width:500,height:700,alt:"User image"})," ",(0,i.jsx)("span",{className:"".concat(e.status===Z.qb.ONLINE?"bg-green-500":"bg-red-500"," w-4 h-4 border-2 border-white rounded-full")}),(0,i.jsx)("p",{className:"grow text-xl ml-2 font-semibold text-gray-800 ",children:e.firstname})]}),(0,i.jsx)("button",{onClick:()=>{t((0,m.jN)(!0))},className:"border-2 p-1 rounded-lg flex justify-center items-center hover:bg-gray-200",children:(0,i.jsx)(S.it,{})})]})},R=e=>{let{message:t}=e,n=Number(localStorage.getItem("id")),s=t.senderId===n?"justify-end":"justify-start";return(0,i.jsx)("div",{className:"".concat(s," flex items-start space-x-2 p-2"),children:(0,i.jsxs)("div",{className:"flex flex-col w-full max-w-[300px] leading-1.5 p-4 border border--200 bg-gray-100 rounded-e-xl rounded-es-xl",children:[(0,i.jsx)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:(0,i.jsx)("span",{className:"text-sm font-normal text-gray-500",children:t.time?t.time.substring(5,16).replace("T"," "):""})}),(0,i.jsx)("p",{className:"whitespace-pre text-sm font-normal py-2.5 text-gray-900",children:t.message})]})})},F=()=>{let e=(0,o.useRef)(null),t=(0,l.v9)(e=>e.chattingSlice.messages),n=(0,l.v9)(e=>e.chattingSlice.currentUser),s=(0,l.I0)(),r=(0,l.v9)(e=>e.chattingSlice.scrollDirection);return(0,o.useEffect)(()=>{"down"===r&&e.current&&(e.current.scrollTop=e.current.scrollHeight)},[t]),(0,i.jsx)("div",{className:"max-h-[400px] min-w-96 min-h-96 overflow-hidden hover:overflow-y-scroll",ref:e,onScroll:()=>{var r;if(0!==t.length&&(null===(r=e.current)||void 0===r?void 0:r.scrollTop)===0){let e=t[0].time;console.log("standardTime",e),s((0,L.SQ)({targetId:n.id,time:e.slice(0,-5)+"%2B0900"})),s((0,m.sl)("up"))}},children:t.map((e,t)=>(0,i.jsx)("div",{className:e.message.length?"":"hidden",children:(0,i.jsx)(R,{message:e})},t))})};(s=r||(r={}))[s.MAX_LENGTH=500]="MAX_LENGTH";var W=()=>{let e=(0,l.v9)(e=>e.chattingSlice.sendMessage),t=(0,l.v9)(e=>e.chattingSlice.currentUser),n=Number(localStorage.getItem("id")),s=(0,l.I0)(),r=j(),a=(0,o.useRef)(null),c=e=>""===e.trim(),d=()=>{c(e)||(null==r||r.emit("send_message",{recver_id:t.id,sender_id:null!=n?n:0,message:e}),s((0,m.aC)({sender_id:null!=n?n:0,message:e})),s((0,m.sl)("down")),s((0,m.W9)("")))};return(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"chat",className:"sr-only",children:"Your message"}),(0,i.jsxs)("div",{className:"flex items-center px-3 py-3 rounded-b-xl border bg-gray-50 ",children:[(0,i.jsx)("textarea",{id:"chat",value:e,onKeyUp:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),d())},rows:2,onChange:e=>s((0,m.W9)(e.target.value)),maxLength:500,placeholder:"Your message... (.../".concat(500,")"),className:"whitespace-pre block mx-4 p-2.5 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-green-400 focus:border-green-400 ",style:{resize:"none"},ref:a}),(0,i.jsxs)("button",{type:"button",className:"flex justify-center p-2 text-green-600 rounded-full cursor-pointer hover:bg-green-100 ",onClick:d,children:[(0,i.jsx)(S.uq,{direction:"right",size:"4"}),(0,i.jsx)("span",{className:"sr-only",children:"Send message"})]})]})]})},X=()=>(0,i.jsx)(T(),{children:(0,i.jsxs)("div",{className:"items-center max-w-96 bg-white rounded-xl border-2 border-green-300",children:[(0,i.jsx)(U,{}),(0,i.jsx)(z,{MenuBar:(0,i.jsx)(A,{}),viewMessage:(0,i.jsx)(F,{}),sendMessage:(0,i.jsx)(W,{})})]})}),Y=n(5373),$=e=>{let{children:t}=e;return(0,i.jsx)("div",{children:(0,i.jsx)(l.zt,{store:Y.Z,children:(0,i.jsxs)(v,{children:[(0,i.jsx)(C,{}),(0,i.jsx)(O,{props:(0,i.jsx)(X,{})}),(0,i.jsx)("main",{children:t}),(0,i.jsx)(b,{})]})})})}},6731:function(e,t,n){"use strict";var s=n(657),r=n(7580),i=n(178),l=n(4207);t.Z=e=>{let{style:t,backgroundColor:n}=e,a=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let e=new i.xsS,t=a.current;if(!t)return;let s=new i.CP7({canvas:t,antialias:!0}),r=new i.cPb(35,t.width/t.height,.1,1e3);r.position.set(0,0,6),e.background=new i.Ilk(n);let o=new i.Ox3(n,4);o.position.set(3,5,8),e.add(o);let c=new l.E,d=(t,n)=>{let s=t.scene;return s.position.x=n,e.add(s),s},u=t=>{let n=n=>{let i=n.clientX/window.innerWidth*2-1||0,l=n.clientY/window.innerHeight*2-1||0;t.rotation.x+=.2*(l/3*Math.PI-t.rotation.x),t.rotation.y+=.2*(i/3*Math.PI-t.rotation.y),s.render(e,r)};return document.addEventListener("mousemove",n),()=>{document.removeEventListener("mousemove",n)}};return c.load("/cup/scene.gltf",t=>{let n=d(t,0);n.rotation.z-=.3,u(n),s.render(e,r)}),()=>{}},[]),(0,s.jsx)("canvas",{className:t,ref:a,id:"cup"})}},4918:function(e,t){"use strict";async function n(){return new Promise((e,t)=>{navigator.geolocation||t(Error("Geolocation is not supported by this browser.")),navigator.geolocation.getCurrentPosition(t=>{let{latitude:n,longitude:s}=t.coords;e({latitude:n,longitude:s})},e=>{t(e)})})}async function s(){try{let{latitude:e,longitude:t}=await n();localStorage.setItem("user-location",JSON.stringify({latitude:e,longitude:t}))}catch(e){}}t.Z=s},6400:function(e,t,n){"use strict";function s(e){let{time:t}=e;return("now"===t?new Date().toISOString():t).replace("T"," ").replace("Z","")+"000%2B0000"}n.d(t,{I:function(){return s}})}},function(e){e.O(0,[495,327,437,400,406,301,222,194,949,373,60,670,744],function(){return e(e.s=4627)}),_N_E=e.O()}]);